%%=============================================================================
%% POC Outsystems
%%=============================================================================

\chapter{POC: Outsystems}
\label{ch:outsystems-poc}

%% TODO: Hoe ben je te werk gegaan? Verdeel je onderzoek in grote fasen, en
%% licht in elke fase toe welke stappen je gevolgd hebt. Verantwoord waarom je
%% op deze manier te werk gegaan bent. Je moet kunnen aantonen dat je de best
%% mogelijke manier toegepast hebt om een antwoord te vinden op de
%% onderzoeksvraag.

% TODO: kleine inleiding

\section{Voorbereiding}

\subsection{Van 0 tot de eerste app uitvoering}

De eerste stap is om een account aan te maken, hierna kan de Outsystems software geinstalleerd worden (Service Studio als gewone IDE en Extension studio om uitbreidingen te maken).\\
In de persoonlijke omgeving kan naast het maken van een nieuwe app community componenten van de Forge ook rechtstreeks geinstalleerd worden. \\
Bij het maken van een app zijn er vijf keuzes: reactive of tradiotionele wab app. Tablet of Telefoon app. Ten laatste ook een service. Er is voor reactive gekozen omdat er in de POC in PowerApps twee versies gemaakt zijn en de app dus over meerde platformen moet kunnen gebruikt worden. Na de creatie van de app wordt ook een module aangemaakt.\\
De eenvoudigste manier om data te introduceren is door een Excel file op te laden. De data hieruit wordt naar een cloud instantie van SQL Server opgeslagen.\\
Als de app gestart wordt moeten Outsystems credentials opgegeven worden.
Dit is de basis om de requirements uit te kunnen beginnen werken maar eerst nog wat uitleg bij het gebruik van de IDE.

\subsection{IDE en begrippen}
Er zijn een aantal functies aanwezig, hier uitgelegd per mogelijke weergave paneel:
\begin{itemize}
    \item \textbf{Centraal:} Hier kunnen de UI flows (onderlinge verhouding van de schermen), ontwerpweergave van een scherm of een methode weegave staan.
    \item \textbf{Links:} Een overzicht van de beschikbare UI controls of methode acties.
    \item \textbf{Rechts:} Context views voor de processen, interface, de logica en de data. Aangevuld met een properties paneel wanneer toepasselijk.
\end{itemize}

[afb-ide]

Er zijn een aantal begrippen die gekend moeten zijn bij het maken van applicaties.
\begin{itemize}
    \item TrueChange Debugger:\\
    Zoals verwacht van een debugger kunnen breakpoints gezet worden en zijn tijdnes uitvoering de waarden van de actieve variabelen in te kijken. Het interessante is dat hiernaast de app geanalyseerd wordt en performantie en security aanbevelingen teruggegeven worden.
    \item One Click Publish:\\
    Stappen uit traditionele software ontwikkeling om een ap beschikbaar te stellen (vierifieeren, compileren, uploaden en publiceren van code) worden geautomatiseerd met één knop. Als verificatie faalt moeten de fouten eerst uit de app gehaald worden.
    Dit betekend ook dat wijzigingen altijd onine worden gezet voor het resultaat bekeken kan worden.
    \item AI Assisted development:\\
    Tijdens ontwikkeling wordt AI gebruikt om onder andere sleutelwoorden en app context te anlyseren en op basis hiervan acties aan te bevelen. Een voorbeeld van het gebruik in de POC was dat waneer een actie aangemaakt werd in de lijst op het hoofdscherm er voorspeld werd dat er detailweergave nodig was. Dit detailscherm en bijbehorend formulier werd automatisch gegenereerd.
    \item Aggregate VS SQL Query:\\
    Er zijn twee manieren om data te queryen. Een aggregate is is eenvoudig te declareren en beter geoptimaiseerd in Outsystems dan een gewone SQL query. Die is echter flexibeler en het gebruik ervan wordt aangeraden wanneer iets niet mogelijk is met een aggregate. Beiden werden gebruikt in de POC en komen verder aan bod.
    \item Datatypen:
    \item Expressie taal:
    \item REST acties:
    \item Meer over de Extenstion Studio:
\end{itemize}

\section{Model van Opstelling}

%TODO

\section{Requirements}

\subsubsection{Prijs}

De Personal Environment (gratis versie) legt geen beperkingen op de bruikbare functionaliteit of hoe lang deze omgeving beschikbaar is. Dit betekend echter niet dat er geen limieten zijn. De hamvraag is of deze limieten aanvaarbaar zijn voor het gebruiksscenario van de POC. Ze worden daarom één per één afgetoetst:

\begin{itemize}
    \item Maar één ontwikkelaar in de omgeving, er is geen samenwerking mogelijk.\\
    $\rightarrow$ De app is niet zodanig complex dat meerdere personen nodig zijn om te ondersteunden of verder uit te bouwen.
    \item Database capacitiet is gelimiteerd op 2GB.\\
    $\rightarrow$ De bij te houden informatie over de meer dan 1000 assets valt hier nog steeds ruim onder.
    \item Indien de app een maand niet gebruikt wordt gaat de omgeving 'in slaap' en moet de app opnieuw gegenereerd worden voro deze opnieuw gebruikt kan worden.\\
    $\rightarrow$ De app zal dagelijks gebruikt worden dus dit zal nooit een risico worden.
    \item Cloud resoruces worden gedeelt met andere gerbuikers, er is geen service garantie.\\
    $\rightarrow$ De app eist geen intens reqource gebruik. 
    \item er is geen harde limiet op aantal toegestane  app gebruikers maar als de vorige items in beschouwing genomen worden zal een app bruikbaar zijn tot maximum 100 personen.\\
    $\rightarrow$ Maximum 6 personen zullen de app gebruiken.
\end{itemize}
[bron-licence-details]

De marktleidende low-code paltformen gefocust op professionele ontwikkelaars zijn duurder van de concurrentie. Mendix en Outsystems rekenen meer dan \euro2000 voor hun basis plan. Het was daarom belangrijk dat de POC binnen de limieten bleef, de meerprijs zou niet worden aanvaard.

\subsubsection{Overzicht kunnen geven van belangrijkste info voor elk toestel in het netwerk}

Dit wordt gedaan via een hoofdscherm met een overzicht van de assets en een detail/editscherm dat meer informatie toont.
Waar dit bij PowerApp gegenereerd kan worden uit data kunnen dezelfde resultaten eenvoudig bekomen worden met behulp van AI geassisteerde acties.
\begin{enumerate}
    \item Een nieuw scherm aanmaken en kiezen voor een lijstweergave sjabloon
    \item De data slepen naar het tabel element volstaat na wat kolom aanpassingen om een gewenste weergave van de data te krijgen. Achter de schermen wordt een aggregate aangemaakt die de rijen ophaalt uit de databank.
    \item Als een knop aangemaakt wordt in de rij zal als actie aanbevolen worden dat er een nieuw scherm wordt aangemaakt met een detailweergave. In de achtergrond wordt de id van de rij item meegegeven om in het detailscherm een aggregaet in te stellen die deze id gebruikt om alle data van de item op te halen en te tonen.
    \item In het detailschemn kan de layout aangepast worden naar wens en kan validatie ingesteld worden.
\end{enumerate}

[[afb-hoofd][afb-detail]]

Dit instellen van validatie is belangrijk. Omdat de data recent werd geïmporteerd naar de SQL instantie zijn er geen specifieke regels op ingesteld. Als een externe data bron gebruikt werd (bijvoorbeeld SharePoint) had dit wel het geval kunnen zijn.\\
Outsystems heeft automatische client side validatie. [bron-validatie] In het formulier widget heeft elk inputveld geassocieerd met een kolom een nodig inputtype (zoals mail, datum, tekst) toegewezen gekregenn, elke input is standaard ook verplicht (via het 'mandatory' property). Het formulier zelf heeft een Valid boolean property dat op false wordt gezet als validatie in één van de inputs zou falen. Controle hierop gebeurt in de client actie gekoppeld aan de knop om toe te voegen of te wijzigen. Het is deze actie die gewijzigd moet worden volgens het specifieke scenario.

[afb-validatie]
[afb-validatie2]

Gaat het om het toevoegen van nieuwe entry of wijzigen van een bestaande? Indien het een nieuwe is wordt gekeken of het ingevulde Netwnaam uniek is vie de server actie 'NetwNaamUnique'. Deze zal een aggregate uitvoeren waarin een filter toegepast is  die kijkt of de meegegeven Netwnaam matcht aan een waarde uit de NETWNAAM kolom. Indien de netwerknaam uniek is word verder gegaan met de formvalidatie. Indien niet wordt een error message gekoppeld aan de textinput van de Netwnaam en stopt de actie.

\subsubsection{Filtering / rapportage}

\textit{Filter}

Zoeken en filteren is in tabbladen gescheiden en ook hun resultaten worden in aparte Tabke controls weergegeven.

$\rightarrow$ Search:

Voorbereidend wordt er een filter ingesteld in de reeds bestande aggregate (die items ophaalt om weer te geven in het hoofdscherm) die een zoekvariabele zal matchen aan elke kolom.
Er wordt een zoekveld toegevoegd aan het scherm en deze zoekvariabele wordt eraan gekoppeld. Als OnChange event wordt een client actie utigevoerd die de aggregate ververst (en de filter opnieuw uitvoert met de gewijzigde zoekvariabele).

\begin{lstlisting}
Blad1.NETWNAAM like "%" + SearchVar + "%" or Blad1.RECTYPE like "%" + SearchVar + "%" or ... or Blad1.KLEUR like "%" + SearchVar + "%"
\end{lstlisting}

$\rightarrow$ Filter:
\begin{itemize}
    \item \textbf{Vorm en datatypen:}\\
    De filter bouwen gebeurt via een dynamisch groeiende lijst waarbij elke rij bestaat uit een keuzeveld voro de kolom, de soort vergelijking en de tekst om op te filteren.\\
    Er moeten enkele datatypen voorbereid worden om dit mogelijk te maken:
    \begin{itemize}
        \item Statische entitieit die alle kolomnamen bevat
        \item Statische entitieit die alle mogelijke vergelijkingen/operators bevat.
        \item Structuur die de filterwaarden van een rij zal vasthouden. Dit is een samngesteld type, het bevat:
        \begin{itemize}
            \item Identifier van de entiteit met kolomnamen.
            \item Identifier van de entiteit met operators.
            \item Een Text variabele met de filterwaarde.
        \end{itemize}
    \end{itemize}
    In de interface moeten nog twee variabelen aangemaatk worden: een Record List van de 'FilterVelden' (zal elke filterwaarde bevatten) en een Record van 'FilterVelden' (stelt een lege rij voor). Ten laatste moet wat hierboven aangemaakt is correct toegewezen worden aan de properties van de dropdowns.[afb-props]\\
    Een extensie werd gebruikt om hier wijs uit te geraken. [bron-advanced-fitler]
    \item \textbf{Query:}\\
    De 'Filter' knop voert de 'FilterOnClick' client actie uit die op zijn beurt de 'Fitler' server actie utivoert. De record List is wordt als argument meegegeven.\\
    De 'Filter' actie: [link naar afbeelding]
    \begin{enumerate}
        \item Controleren of de Record List leeg is indien ja stopt de utivoering.
        \item De eerste entry naar een string converteren. 
\begin{lstlisting}
GetColNamen(VglRecList[0].velden.ColNaamAtt).ColNamen.Naam + " " + GetVergelijkTekens(VglRecList[0].velden.VergelijkTekenAtt).VergelijkTekens.Teken + " '" + VglRecList[0].velden.FilterWaarde + "'"
\end{lstlisting}
        \item Controleren of er meerdere records zijn. Indien ja wordt er geloopt en wordt de string verder aangevult via  onderstaande expressie:
\begin{lstlisting}
TestStringParam + " and " + GetColNamen(VglRecList.Current.velden.ColNaamAtt).ColNamen.Naam + " " + GetVergelijkTekens(VglRecList.Current.velden.VergelijkTekenAtt).VergelijkTekens.Teken + " '" + VglRecList.Current.velden.FilterWaarde + "'"
\end{lstlisting}
        \item De sql query uitvoeren. Een opmerking hierbij is dat de 'expand inline' optie actief moet staan om de gebouwde string effectief te kunnen gebruiken als argument. De query zelf is een simpele WHERE met door AND aaneengeschakelde evaluaties.
        [afb-query]
    \end{enumerate}
    De gereturnde filterresultaten worden in een aparte Table geplaatst. Dit maakt het exporteren als report ook makkelijker\\
    De gevonden beperkingen zijn dat het evalueren met sommige kolommen niet juist werkt en dat de performantie lager is dan bij een aggregate.
\end{itemize}

[filter-afb]

\textit{Reporting}

Downloadacties zijn goed ondersteund. Door een download control als eindpunt van een actie tes zetten wordt de geconfigureerde inhoud ervan aangeboden in een download prompt. De specifiek geconfigureerde acties om dit te bereiken worden opgeroepen wanneer er een gewenste dataset gefilterd staat en op de 'Get Excel' knop geduwd werd.
\begin{enumerate}
    \item \textbf{GetExcel (Client actie):} Het filterresultaat naar de server actie doorgeven en de gereturnde Excel file te downloaden zetten.
    \item \textbf{PrepareExcel (Server actie):} De filterresultaten converteren naar een Excel via de 'Record List to Excel' stap.
\end{enumerate}

[afb beide methoden klein horizontaal onder elkaar][afb van prompt om tedownloaden?]

\subsubsection{RDP / Ping}

\textit{RDP (Remote Desktop Protocol)}

Omdat de POC in de cloud draait is deze functionaliteit niet direct op te roepen, mogelijke workarounds:
\begin{itemize}
    \item \textbf{Workaround 1:} Client side javascript, specifiek een ActiveX plugin gebruiken om shell commando's uit te voeren. [voetnoot]\\
    $\rightarrow$ 'ActiveX not defined' error. Dit enkel mogelijk met oudere versies van Internet Explorer. Het is ook logisch dat dit niet meer ondersteund is vanuit security aspect.
    \item \textbf{Workaround 2:} Een 'link' control en de href property laten wijzen naar een locale RDP file\\
    $\rightarrow$ Niet flexibel genoeg: de rdp config file zou elke keer aangepast moeten worden met het relevante ip adres.
    \item \textbf{Workaround 3:} De webbrowser waar de POC in werkt configureren om custom urls te kunnen gebruiken (zoals rdp://). Vanuit de app naar dat soort url navigeren via de ingebouwde 'RedirectToUrl' functie.\\
    $\rightarrow$ Te veel extra configuratie.
    \item \textbf{Workaround 4:} Een RPD file maken voor de gewenste pc en downloaden/uitvoeren. Dit past delen toe zoals gezien in extensie [voetnoot]. Er is ook een dependancy nodig om text naar binaries te converteren.\\
    Er worden drie gegevensstukken gecombineerd: ip adres van de doel pc, naam van de bevoegde rdp gebruiker en het sjabloon van een rdp configuratiebestand. In de client methode wordt het sjabloon ingevuld met de eerste twee waarden en hierna geconverteerd naar een binary. Ten laatste wordt dit bestand als download aangeboden. In de meeste webbrowsers is het als voorkeur in te stellen om bepaalde bestandstypen direct te openen na downlaod. Dat maakt het tijdsverlies bij elke uitvoering miniem.
    %[[afb-methode horizontaal][afb preview sjabloon met ingewisselde ip]]
\end{itemize}

\textit{Ping}


\subsubsection{Mobiel bruikbaar zijn}
\subsubsection{Future proof zijn}
\subsubsection{Performant zijn}
\subsubsection{Security}
\subsubsection{Gerichte/basis taken kunnen automatiseren}
\subsubsection{Bruikbaar zijn buiten domein}
\subsubsection{SharePoint requirements}

Requirements die met SharePoint te maken hebben zijn:
\begin{itemize}
    \item Nieuwe types toestellen opnemen
    \item Randapparatuur opnemen
    \item Revisie van elk dataveld per toesteltype
    \item Data opslaan in SharePoint (cloud)
\end{itemize}

\subsubsection{Leercurve moet degelijk zijn}
\subsubsection{Samenwerken met SCCM en/of synchroniseren met en data uit de SQL databank kunnen gebruiken}
\subsubsection{Diverse GUI verbeteringen/robuust GUI ontwerp ondersteunen}
\subsubsection{Barcodes kunnen scannen}
\subsubsection{AI functionaliteit}